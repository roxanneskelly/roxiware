<div class="account_edit_overlay overlay" id="account_edit_overlay">
  <%= form_tag do %>
    <div class="span-16 last">

      <div class="span-12 last"><%= label_tag :role, "Role", :class=>"span-3 left"%>
      <%= select_tag :role, options_for_select({"Admin"=>:admin, "User"=>:user, "Guest"=>:guest}), :class=>"span-5 last" %></div>
      <div class="span-12 last"><%= label_tag :username, "Username:", :class=>"span-3 left"%>
      <%= text_field_tag :username, nil, :class=>"span-5 last" %></div>

      <div class="span-12 last"><%= label_tag :name, "Name:", :class=>"span-3 left"%>
      <%= text_field_tag :name, nil, :class=>"span-5 last" %></div>

      <div class="span-12 last"><%= label_tag :email, "Email:", :class=>"span-3 left"%>
      <%= text_field_tag :email, nil, :class=>"span-5 last" %></div>
      <div class="span-12 last"><%= label_tag :password, "Password:", :class=>"span-3 left"%>
      <%= password_field_tag :password, nil, :class=>"span-5 last" %></div>
      <div class="span-12 last"><%= label_tag :password_confirmation, "Confirm:", :class=>"span-3 left"%>
      <%= password_field_tag :password_confirmation, nil, :class=>"span-5 last" %></div>

      <div id="save_control" class="save_button left last">&nbsp</div>
    </div>
  <% end %>
</div>
<script>
$(document).bind("ready", function() {
    $(".account_delete_button").click(function(event) {
       var account_id = $(this).attr("id").split("-")[2];
       endpoint = "/account/" + account_id + ".json";
       $.ajax({
                url: endpoint,
                type: "DELETE",
                processData: false,
                complete: function(event) {
                   window.location.reload();
                   }
               });
        });


    $("div[rel=#overlay_account]").overlay( {
         effect: 'apple',
         onClose: function() { 
         },
         target: '#account_edit_overlay',
         onBeforeLoad: function() {
            var account_id = this.getTrigger().attr("id").split("-")[2];
            var endpoint = "/account";
            var method = "POST";
            if (account_id != "new")
            {
               method = "PUT";
               endpoint = "/account/"+account_id;
            }
            $(".account_edit_overlay").popup_form(endpoint,
                  {
                    canEdit: true,
                    method: method,
                    success: function(xhr, status) {
                       window.location.reload();
                    }
                  });
        }
    });
});
</script>

