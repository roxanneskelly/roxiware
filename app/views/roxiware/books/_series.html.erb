<article id="series_<%=series.id%>" class="series_listing" rel="<%= book_series_path(series.id) %>">
    <a href="<%= book_series_path(series.seo_index) %>" class="series_link"><div class="series_title"><%= series.title %></div></a>
    <div class="series_description"><%= raw series.description %></div>
    <div class="series_books">
      <% if @series_disoplay_type == "accordion" %>
        <% series.books.order(:series_order).each do |book| %>
	   <div class="series_book_tab"><div class="series_book_title"><%= book.title %></div></div><div class="series_book_info"><%= render :partial=>"book", :locals=>{:book=>book, :book_image_url=>book.image_url, :book_description_length=>series_book_description_length}  %></div>
	<% end %>
      <% elsif @series_display_type == "simple" %>
        <div class= "series_book_titles"><%= series.books.order(:series_order).collect{|book| book.title }.join (", ") %></div>
      <% end %>
    </div>
</article>
<script>
$(function() {

<% if @series_display_type == "accordion" %>
   var series = $("article#series_<%= series.id %>");
   var pane_height = 0;
   var pane_width = series.find(".series_books").width();
   series.find(".series_book_tab").each(function(index, tab) {
      pane_width = pane_width - $(tab).outerWidth();
      pane_width = pane_width-1;
   });
   series.find(".series_book_info").each(function(index, pane) {
       console.log($(pane).height());
       if(pane_height < $(pane).height()) {
           pane_height = $(pane).height();
       }
   });

   series.find(".series_book_info").first().css("display","block").css("width",pane_width+"px");
   series.find(".book_listing").css("width",pane_width+"px");
   series.find(".book_listing").css("height",pane_height+"px");
   series.find(".series_book_tab").css("height",pane_height+"px");
   series.find(".series_books").tabs(series.find("div.series_book_info"), {tabs:series.find("div.series_book_tab")});
<% end %>
});
</script>
