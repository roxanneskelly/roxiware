<%= content_tag(:div, :id=>"forum_board_groups") do
    @forum_board_groups.collect do |group|
        content_tag(:div, group.name, :class=>"forum_board_group_name") +
        content_tag(:div, :id=>group.id, :class=>"forum_board_group") do 
            group.boards.visible(current_user).collect do |board|
                new_posts_class = (board.post_count != (@board_data[board.id.to_s] || 0)) ? "forum_board_new_posts" : "forum_board_no_new_posts"
                content_tag(:div, :id=>board.id, :class=>"forum_board #{new_posts_class}") do
                    content_tag(:div, :class=>"forum_board_info") do 
                        link_to(board.name, forum_path(board.seo_index), :class=>"forum_board_name") +
                        (content_tag(:div, board.description, :class=>"forum_board_description") if board.description.present?)
                    end +
                    content_tag(:div, :class=>"forum_board_counters") do
                        content_tag(:div, board.topic_count, :class=>"forum_board_topic_count") +
                        content_tag(:div, :class=>"forum_board_post_count") do 
		            content_tag(:span, board.post_count) + 
		            (content_tag(:span, board.pending_post_count, :class=>"forum_board_pending_post_count") if can?(:edit, board))
                        end
                    end +
	            content_tag(:div, :class=>"forum_board_last_post forum_board_menu_target", :rel=>forum_path(board.id), :board_permission=>board.permissions) do 
	                if board.last_post.present? && board.last_post.post.present? 
		            link_to(board.last_post.post.title, board.last_post.post.topic_link, :class=>"forum_board_last_post_title") + 
		            (board.last_post.comment_author.present? ? link_to(board.last_post.comment_author.name, board.last_post.comment_author.url, :class=>"forum_board_last_post_author") : content_tag(:div, "Unknown", :class=>"forum_board_last_post_author")) +
		            content_tag(:div, board.last_post.comment_date.localtime.strftime("%c"), :class=>"forum_board_last_post_date")
                        else
                            "".html_safe
		        end
                    end
                end 
            end.join("").html_safe 
        end 
    end.join("").html_safe
end %>
<% if can? :edit, Roxiware::Forum::Board %>
<%= render :partial=>"roxiware/forum/board_manage_control" %>
<% end %>
